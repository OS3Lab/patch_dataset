#!/bin/bash

# 定义要执行的命令列表
COMMANDS=(
    "./python -m test -v test_ast"
    "./python -m test -v test_int"
    "./python -m test -v test_compile"
    "./python -m test -v test_decimal"
    "./python -m test -v test_cmd_line"
    "./python -m test -v test_json"
    "./python -m test -v test_sys"
    "./python -m test -v test_xmlrpc"
)

# 逐个执行命令并监控输出
for COMMAND in "${COMMANDS[@]}"
do
    echo "Running command: $COMMAND"
    $COMMAND | while IFS= read -r line
    do
        echo "$line"  # 输出当前行
        if [[ "$line" == *"Tests result: FAILURE"* ]]; then
            echo "Detected 'fail' in output. Terminating..."
            pkill -P $$  # 终止所有子进程
            exit 1
        fi
    done

    # 检查上一个命令的退出状态
    if [ $? -ne 0 ]; then
        echo "Command failed: $COMMAND"
        exit 1
    fi
done

echo "All commands completed successfully."
exit 0
