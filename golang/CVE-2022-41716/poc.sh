#!/bin/bash
set -euxo pipefail

backport_patch="aba57b07721cac39b4b7cf70f8dfbf9e2e299187"
test_file=("src/os/exec/env_test.go" "src/os/exec/exec_test.go")

for file in ${test_file[@]}; do
    git checkout ${backport_patch} -- ${file}
done

cd src
go mod tidy
../bin/go test os/exec -run '^(TestDedupEnv|TestEnvNULCharacter)$'