#!/bin/bash

# ├── grpc
# ├── build_grpc

set -x

# path to build grpc
build_dir="build_grpc"

# clean and create build directory
cd ..
if [ -d "$build_dir" ] ; then
    rm -rf "$build_dir"
    if [ $? -ne 0 ]; then
        echo "Failed to delete existing $build_dir."
        exit 1
    fi
fi
mkdir $build_dir
if [ $? -ne 0 ]; then
    echo "Failed to create $build_dir."
    exit 1
fi

# configure and make
cd $build_dir
cmake -DgRPC_INSTALL=ON \
      -DgRPC_BUILD_TESTS=OFF \
      ../grpc
if [ $? -ne 0 ]; then
    echo "Failed to configure grpc."
    exit 1
else
    make -j`nproc`
    if [ $? -ne 0 ]; then
        echo "Failed to build grpc."
        exit 1
    fi
fi