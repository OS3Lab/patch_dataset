#!/bin/bash

# ├── qtbase
# ├── build_qt

set -x

# path to build qt
build_dir="build_qt"

# clean and create build directory
cd ..
if [ -d "$build_dir" ] ; then
    rm -rf "$build_dir"
    if [ $? -ne 0 ]; then
        echo "Failed to delete existing $build_dir."
        exit 1
    fi
fi
mkdir $build_dir
if [ $? -ne 0 ]; then
    echo "Failed to create $build_dir."
    exit 1
fi

# configure and make
cd $build_dir
cmake -GNinja -DFEATURE_developer_build=ON ../qtbase
if [ $? -ne 0 ]; then
    echo "Failed to configure qt."
    exit 1
else
    cmake --build . -j`nproc`
    if [ $? -ne 0 ]; then
        echo "Failed to build qt."
        exit 1
    fi
fi